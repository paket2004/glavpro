import streamlit as st
import pandas as pd
from docx import Document
from docx.shared import Inches
from docx.shared import Inches, Pt, RGBColor
from docx.enum.text import WD_PARAGRAPH_ALIGNMENT
from docx.enum.text import WD_ALIGN_PARAGRAPH

# Заголовок приложения
st.title("Редактируемая таблица с направлениями")

# Задаём колонки
columns = ["Направление", "Расстояние, м", "Адрес", "Категория земель и разрешённое использование"]

# Инициализация DataFrame с заполненной колонкой "Направление"
if 'df' not in st.session_state:
    # Создаём DataFrame с колонкой "Направление", заполненной сторонами света
    directions = ["Север", "Северо-восток", "Восток", "Юго-восток", "Юг", "Юго-запад", "Запад", "Северо-запад"]
    data = {
        "Направление": directions,
        "Расстояние, м": [""] * len(directions),
        "Адрес": [""] * len(directions),
        "Категория земель и разрешённое использование": [""] * len(directions)
    }
    st.session_state.df = pd.DataFrame(data)

# Отображаем редактируемую таблицу
st.write("Введите данные в таблицу:")
edited_df = st.data_editor(st.session_state.df, num_rows="dynamic")  # Фиксированное количество строк

# Сохраняем изменения в session_state
st.session_state.df = edited_df

# Кнопка для вывода данных
if st.button("Показать введённые данные"):
    st.write("Введённые данные:")
    st.write(st.session_state.df)

# Добавляем текстовый блок с выбором направления и расстояния
st.write("### Введите данные о ближайшей нормируемой территории")

# Выбор направления
direction = st.selectbox(
    "Выберите направление:",
    ["восточном", "северном", "южном", "западном", "северо-западном", "северо-восточном", "юго-западном", "юго-восточном"]
)

# Ввод расстояния и адреса
distance = st.number_input("Введите расстояние (в метрах):", min_value=0, value=0)
address = st.text_input("Введите адрес:", value="Российская Федерация, Оренбургская область, Первомайский район, село Мирошкино, улица Центральная, 29 А")

# Формируем текст
text = f"       Ближайшая нормируемая территория (земельные участки, предназначенные для размещения объектов рекреационного и лечебно-оздоровительного назначения) для промышленной площадки расположена в {direction} направлении на расстоянии {distance} метра ({address})."

# Отображаем текст
st.write("### Сформированный текст:")
st.write(text)

# Кнопка для сохранения таблицы и текста в Word
if st.button("Сохранить таблицу и текст в Word"):
    # Создаём новый документ Word
    doc = Document()
    # Добавляем сформированный текст в документ (перед таблицей)
    style = doc.styles['Normal']
    style.font.name = 'Times New Roman'  # Название шрифта
    heading = doc.add_heading(level=1)
    heading.alignment = WD_ALIGN_PARAGRAPH.CENTER
    run = heading.add_run("1.2.2 Описание санитарно-защитной зоны")
    run = heading.runs[0]
    run.font.color.rgb = RGBColor(0, 0, 0)  # Black color
    run.font.name = 'Times New Roman'
    run.font.size = Pt(8)
    run.bold = True 
    
    paragraph = doc.add_paragraph()
    run = paragraph.add_run(text)
    run.font.name = 'Times New Roman'
    run.font.size = Pt(6)

    # Создаём таблицу в Word
    table = doc.add_table(rows=1, cols=len(columns))
    table.style = 'Table Grid'
    # Добавляем заголовки столбцов
    # Добавляем заголовки столбцов и устанавливаем шрифт
    hdr_cells = table.rows[0].cells
    for i, col in enumerate(columns):
        hdr_cells[i].text = col
        # Устанавливаем шрифт для заголовков
        for paragraph in hdr_cells[i].paragraphs:
            for run in paragraph.runs:
                run.font.name = 'Times New Roman'
                run.font.size = Pt(6)
    
    # Добавляем данные из DataFrame в таблицу Word
    for index, row in st.session_state.df.iterrows():
        row_cells = table.add_row().cells
        for i, col in enumerate(columns):
            row_cells[i].text = str(row[col])
            # Устанавливаем шрифт для ячеек данных
            for paragraph in row_cells[i].paragraphs:
                for run in paragraph.runs:
                    run.font.name = 'Times New Roman'
                    run.font.size = Pt(6)
    

    text = f"""
        СанПиН 1.2.3685-21 «Гигиенические нормативы и требования к обеспечению безопасности и (или) безвредности для человека факторов среды обитания» и СанПиН 2.2.1/2.1.1.1200-03 «Санитарно-защитные зоны и санитарная классификация предприятий, сооружений и иных объектов» для предотвращения неблагоприятного воздействия загрязнения атмосферного воздуха на здоровье населения и установления обязательных гигиенических требований и в целях обеспечения безопасности населения и в соответствии с Федеральным законом «О санитарно-эпидемиологическом благополучии населения» от 30.03.1999 N 52-ФЗ, вокруг объектов и производств, являющихся источниками воздействия на среду обитания и здоровье человека устанавливается специальная территория с особым режимом использования - санитарно-защитная зона (СЗЗ), размер которой обеспечивает уменьшение воздействия загрязнения на атмосферный воздух (химического, биологического, физического) до значений, установленных гигиеническими нормативами. 
        По своему функциональному назначению санитарно-защитная зона является защитным барьером, обеспечивающим уровень безопасности населения при эксплуатации объекта в штатном режиме. 
        СЗЗ устанавливается в целях:
        1. Обеспечения требуемых гигиенических норм содержания в приземном слое атмосферы загрязняющих веществ.
        2. Уменьшение отрицательного влияния на население факторов физического воздействия шума, повышенного уровня вибрации и т.д., производимых предприятием.
        3. Создание архитектурно-эстетического барьера между промышленной и селитебной территориями при существующем ее благоустройстве.
        4. Организации дополнительных озелененных площадей с целью усиления ассимиляции и фильтрации загрязнителей атмосферного воздуха.
        Для промышленных объектов и производств, сооружений, являющихся источниками воздействия на среду обитания и здоровье человека, в зависимости от мощности, условий эксплуатации, характера и количества выделяемых в окружающую среду загрязняющих веществ, создаваемого шума, вибрации и других вредных физических факторов, а также с учетом предусматриваемых мер по уменьшению неблагоприятного влияния их на среду обитания и здоровье человека в соответствии с санитарной классификацией промышленных объектов и производств устанавливаются следующие ориентировочные размеры санитарно-защитных зон:
        промышленные объекты и производства первого класса - 1000 м;
        промышленные объекты и производства второго класса - 500 м;
        промышленные объекты и производства третьего класса - 300 м;
        промышленные объекты и производства четвертого класса - 100 м;
        промышленные объекты и производства пятого класса - 50 м.
        Санитарно-эпидемиологические правила и нормативы СанПиН 2.2.1/2.1.1.1200-03 «Санитарно-защитные зоны и санитарная классификация предприятий, сооружений и иных объектов» (утв. постановлением Главного государственного санитарного врача РФ от 25 сентября 2007 г. N 74) с изменениями и дополнениями от 10 апреля 2008 г., 6 октября 2009 г., 9 сентября 2010 г., 25 апреля 2014 г., 28 февраля 2022 г.:
"""
    # Сохраняем документ
    # doc.add_paragraph(text)
    paragraph = doc.add_paragraph()
    run = paragraph.add_run(text)
    run.font.name = 'Times New Roman'
    run.font.size = Pt(6)
    doc.save("object_property\sanitary_zone\description.docx")
    st.success("Таблица и текст успешно сохранены в object_property\sanitary_zone\description.docx")